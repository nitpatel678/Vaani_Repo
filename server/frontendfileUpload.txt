async function uploadFiles(files, token) {
  // Step 1: request signed URLs
  const res = await fetch("http://localhost:5000/api/files/get-upload-urls", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`,
    },
    body: JSON.stringify({
      files: files.map(f => ({ name: f.name, type: f.type })),
    }),
  });

  const { uploadUrls } = await res.json();

  const uploadedFilePaths = [];

  // Step 2: upload each file to Supabase
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const { signedUrl, fileName } = uploadUrls[i];

    const uploadRes = await fetch(signedUrl, {
      method: "PUT",
      headers: { "Content-Type": file.type },
      body: file,
    });

    if (!uploadRes.ok) throw new Error(`Upload failed for ${file.name}`);
    uploadedFilePaths.push(fileName); // Save file path for backend tracking
  }

  return uploadedFilePaths;
}
